define(["sensor/util"],function(t){function e(e){return this._configs={varsEncode:!1,method:"get",dataType:"json",timeOut:15},t.extend(this._configs,e||{},!0),this.reset()}var o=0;return e.prototype.reset=function(){return clearTimeout(this.timer),this.loading=!1,this.data="",this},e.prototype.jsonp=function(t,e){var n=this,i="Sensor_x_jsonp"+o++,r=document.head,s=document.createElement("script");window[i]=function(t){n.response=t,delete window[i],n.reset().onLoad(),r.removeChild(s)},t=t.replace(/=\?/,"="+i)+(e?"&"+e:""),s.src=t,s.onerror=function(t){n.onFail()},r.appendChild(s)},e.prototype.send=function(t,e){var o=this;if(/=\?/.test(t))return o.ajaxJSONP(t,e);if(!o.loading){var n=o.options,i=o.xmlhttp||(window.XMLHttpRequest?new XMLHttpRequest:!1);return i?(o.xmlhttp=i,o.loading=!0,o.onStart(),i.onreadystatechange=function(){if(4===this.readyState&&0!==this.status){if(!o.timer)return;var t=this.responseText;o.response="json"===n.dataType?JSON.parse(t):t,o.reset().onLoad(),i.onreadystatechange=function(){},i=null,o=null}},"get"===n.method.toLowerCase()?(e?t.match(/\?.*=/)?e="&"+e:"?"!==e[0]&&(e="?"+e):e="",t+=e,i.open("get",t,!0),i.send()):(i.open("post",t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(e)),o.timer=setTimeout(function(){o._onTimeout.apply(o)},1e3*n.timeOut),o):(o.onFail(),o)}},e.prototype.abort=function(t,e){this.loading&&(this.xmlhttp.abort(),this.reset(),this.loading=!1)},e.prototype._onTimeout=function(t,e){this.abort(),this.onTimeout=!1},e.prototype.onStart=function(){},e.prototype.onLoad=function(){},e.prototype.onFail=function(){},e.prototype.onTimeout=function(){},e});